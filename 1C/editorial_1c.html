<h2>
Subtarea 1
</h2>
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">a_i = i</annotation></semantics></math></li>
</ul>
<p>En esta subtarea, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>r</mi></msub><mo>−</mo><msub><mi>a</mi><mi>l</mi></msub><mo>=</mo><mi>r</mi><mo>−</mo><mi>l</mi></mrow><annotation encoding="application/x-tex">a_r - a_l = r - l</annotation></semantics></math>, por lo que siempre es posible ir de <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> a cualquier <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>∈</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo>,</mo><mi>i</mi><mo>+</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">j \in [i+1, i + k]</annotation></semantics></math> en 1 salto. Por tanto, la respuesta para una pregunta <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>l</mi><mo>,</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(l, r)</annotation></semantics></math> es <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">⌈</mo><mfrac><mrow><mi>r</mi><mo>−</mo><mi>l</mi></mrow><mi>k</mi></mfrac><mo stretchy="true" form="postfix">⌉</mo></mrow><annotation encoding="application/x-tex">\left\lceil\frac{r - l}{k}\right\rceil</annotation></semantics></math>.</p>
<h2>
Subtarea 2
</h2>
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>−</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">a_i - a_{i-1} = c</annotation></semantics></math>, para alguna constassnte <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>.</li>
</ul>
<p>La idea es similar. En esta subtarea, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>r</mi></msub><mo>−</mo><msub><mi>a</mi><mi>l</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>r</mi><mo>−</mo><mi>l</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">a_r - a_l = (r - l) \cdot c</annotation></semantics></math>.</p>
<p>Entonces, si queremos ir de <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> a <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math> en un salto, se tiene que cumplir que</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo>−</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><mi>c</mi><mo>≤</mo><mi>k</mi><mo>⇔</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo>−</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>≤</mo><mrow><mo stretchy="true" form="prefix">⌊</mo><mfrac><mi>k</mi><mi>c</mi></mfrac><mo stretchy="true" form="postfix">⌋</mo></mrow></mrow><annotation encoding="application/x-tex">(j - i)\cdot c \le k \iff (j - i) \le \left\lfloor\frac{k}{c}\right\rfloor</annotation></semantics></math>. Por tanto, podemos dar saltos de longitud <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">⌊</mo><mfrac><mi>k</mi><mi>c</mi></mfrac><mo stretchy="true" form="postfix">⌋</mo></mrow><annotation encoding="application/x-tex">\left\lfloor\frac{k}{c}\right\rfloor</annotation></semantics></math>.</p>
<p>Entonces, la respuesta para una pregunta <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>l</mi><mo>,</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(l, r)</annotation></semantics></math> es <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">⌈</mo><mfrac><mrow><mi>r</mi><mo>−</mo><mi>l</mi></mrow><mrow><mo stretchy="true" form="prefix">⌊</mo><mfrac><mi>k</mi><mi>c</mi></mfrac><mo stretchy="true" form="postfix">⌋</mo></mrow></mfrac><mo stretchy="true" form="postfix">⌉</mo></mrow><annotation encoding="application/x-tex">\left\lceil\frac{r - l}{\left\lfloor\frac{k}{c}\right\rfloor}\right\rceil</annotation></semantics></math>.</p>
<h2>
Subtarea 3
</h2>
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>⋅</mo><mi>q</mi><mo>≤</mo><msup><mn>10</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">n\cdot q \le 10^6</annotation></semantics></math>.</li>
</ul>
<p>Podemos resolver cada pregunta en tiempo lineal. Podemos usar dos punteros para dar los saltos óptimos, manteniendo para cada <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>, el mayor <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math> tal que <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>r</mi></msub><mo>−</mo><msub><mi>a</mi><mi>l</mi></msub><mo>≤</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">a_r - a_l \le k</annotation></semantics></math>.</p>
<p>Complejidad temporal: <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathvariant="script"><mi>𝒪</mi></mstyle><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo>⋅</mo><mi>q</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{O}(n\cdot q)</annotation></semantics></math>.</p>
<h2>
Subtarea 4
</h2

Notemos que $k \ge \frac{a_n}{20}$, por lo que $\frac{a_n}{k} \le 20$. Eso quiere decir que la cantidad mínima de pasos para ir desde cualquier punto a otro es menor que o igual a 20. Por tanto, podemos usar la solución de la subtarea anterior.

<h2>
Subtarea 5
</h2>
<p>Digamos que <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>l</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(l)</annotation></semantics></math> es el mayor <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>≥</mo><mi>l</mi></mrow><annotation encoding="application/x-tex">r \ge l</annotation></semantics></math> tal que <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>l</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>≤</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">f(r) - f(l) \le k</annotation></semantics></math>. Si no existe tal <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>, digamos que <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">f(r) = -1</annotation></semantics></math>.</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f()</annotation></semantics></math> se puede computar en tiempo lineal usando dos punteros, de derecha a izquierda.</p>
<p>Podemos considerar esto como un grafo dirigido, donde cada nodo tiene grado de salida 1. De hecho, si consideramos los <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>:</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x: f(x) = -1</annotation></semantics></math> como raíces, este grafo es realmente un bosque con las aristas orientadas desde las hojas hacia la raíz.</p>
<p>Podemos usar la técnica <strong>binary lifting</strong>, que consiste en mantener para cada nodo, la lista de ancestros a distancia <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>0</mn></msup><mo>,</mo><msup><mn>2</mn><mn>1</mn></msup><mo>,</mo><msup><mn>2</mn><mn>2</mn></msup><mo>,</mo><msup><mn>2</mn><mn>3</mn></msup><mo>,</mo><mi>…</mi></mrow><annotation encoding="application/x-tex">2^0, 2^1, 2^2, 2^3, \dots</annotation></semantics></math>.</p>
<p>Si tenemos una pregunta <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>l</mi><mo>,</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(l, r)</annotation></semantics></math>, usando esta lista de ancestros, podemos vorazmente buscar el primer ancestro de <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math> que sea mayor o igual que <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>, y la respuesta sería la diferencia entre las profundidades de <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math> y el ancestro encontrado en el grafo.</p>
